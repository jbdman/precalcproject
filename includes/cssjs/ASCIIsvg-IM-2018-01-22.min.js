/* ASCIIsvg-IM.js
Heavily revised by Murray Bourne, IntMath.com
==============================================================
JavaScript routines to dynamically generate Scalable Vector Graphics
using a mathematical xy-coordinate system (y increases upwards).

Based on ASCIIsvg.js (c) Peter Jipsen http://www1.chapman.edu/~jipsen/

This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, 
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License (at http://www.gnu.org/copyleft/gpl.html) 
for more details.*/

var corpColor = "#165a71";
function gebi(r){return doc.getElementById(r)}function clog(r,t){console.log("lineNum="+t),console.log(r)}function factorial(r,t){null==t&&(t=1);for(var e=r-t;e>0;e-=t)r*=e;return r<0?NaN:0==r?1:r}function C(r,t){for(var e=1,i=0;i<t;i++)e*=(r-i)/(t-i);return e}function chop(r,t){return null==t&&(t=0),Math.floor(r*Math.pow(10,t))/Math.pow(10,t)}function ran(r,t,e){return null==e&&(e=0),chop((t+Math.pow(10,-e)-r)*Math.random()+r,e)}function rk4(r,t,e,i){var n=t,a=e(r,n,0),o=t+.5*a*i,d=e(r+.5*n*i,o,i/2),s=t+.5*d*i,l=e(r+.5*o*i,s,i/2),g=t+l*i;return[r+i/6*(n+2*o+2*s+g),t+i/6*(a+2*d+2*l+e(r+s*i,g,i))]}function pythag(r,t){return Math.sqrt(Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2))}function polarToCartesian(r,t,e,i){var n=-i*Math.PI/180;return{x:r+e*Math.cos(n),y:t+e*Math.sin(n)}}function contains(r,t){for(var e=0;e<r.length;e++)if(r[e][0]===t[0]&&r[e][1]===t[1])return!0;return!1}function makeSVG(r,t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",r);for(var n in t)void 0!==t[n]&&i.setAttribute(n,t[n]);return gebi(e).appendChild(i),i}function removeEle(r){gebi(r)?gebi(r).parentNode.removeChild(gebi(r)):document.getElementsByClassName(r)[0]&&document.getElementsByClassName(r)[0].parentNode.removeChild(document.getElementsByClassName(r)[0])}function setBoardParams(r){r=svgID.replace("SVG",""),xmin=brdPropsArr[r].xMin,ymin=brdPropsArr[r].yMin,xmax=brdPropsArr[r].xMax,ymax=brdPropsArr[r].yMax,boardWidth=brdPropsArr[r].brdWidth,boardHeight=brdPropsArr[r].brdHeight,boardLeft=brdPropsArr[r].Left,boardTop=brdPropsArr[r].Top,xunitlength=brdPropsArr[r].XuL,yunitlength=brdPropsArr[r].YuL,origin[0]=brdPropsArr[r].ox,origin[1]=brdPropsArr[r].oy,padding=brdPropsArr[r].pad,actualXmin=brdPropsArr[r].actualXmin,actualXmax=brdPropsArr[r].actualXmax,actualYmin=brdPropsArr[r].actualYmin,actualYmax=brdPropsArr[r].actualYmax}function angleArc(r,t,e,i,n){var a;null!=n&&(a=doc.getElementById(n)),null==a&&(a=makeSVG("path",{id:n,stroke:stroke,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:fill,"fill-opacity":fillopacity},svgID));var o=polarToCartesian(r[0]*xunitlength+origin[0],r[1]*yunitlength+(boardHeight-origin[1]),t,e),d=polarToCartesian(r[0]*xunitlength+origin[0],r[1]*yunitlength+(boardHeight-origin[1]),t,i),s=i-e<=180?"0":"1",l="M"+o.x.toFixed(2)+","+o.y.toFixed(2)+" A"+t+","+t+" 0 "+s+" 0 "+d.x.toFixed(2)+","+d.y.toFixed(2)+" L"+d.x.toFixed(2)+","+d.y.toFixed(2)+" "+r[0]*xunitlength+origin[0]+","+r[1]*yunitlength+(boardHeight-origin[1])+" Z";a.setAttribute("d",l)}function arc(r,t,e,i){var n,a;null!=i&&(n=doc.getElementById(i)),null==e&&(a=[t[0]-r[0],t[1]-r[1]],e=Math.sqrt(a[0]*a[0]+a[1]*a[1])),null==n&&(n=makeSVG("path",{id:i,fill:fill,"fill-opacity":fillopacity,"stroke-width":strokewidth,stroke:stroke,"stroke-opacity":.5},svgID)),n.setAttribute("d","M"+(r[0]*xunitlength+origin[0])+","+(boardHeight-r[1]*yunitlength-origin[1])+" A"+e*xunitlength+","+e*yunitlength+" 0 0,0 "+(t[0]*xunitlength+origin[0])+","+(boardHeight-t[1]*yunitlength-origin[1])),"arrow"==marker||"arrowdot"==marker?(u=[(t[1]-r[1])/4,(r[0]-t[0])/4],a=[(t[0]-r[0])/2,(t[1]-r[1])/2],a=[r[0]+a[0]+u[0],r[1]+a[1]+u[1]]):a=[r[0],r[1]],"dot"==marker||"arrowdot"==marker?(ASdot(r,markersize,markerstroke,markerfill),"arrowdot"==marker&&arrowhead(a,t),ASdot(t,markersize,markerstroke,markerfill)):"arrow"==marker&&arrowhead(a,t)}function arrowhead(r,t,e){$p=r,$q=t,void 0===e&&(e="arrHead"+Math.floor(1e3*Math.random())),$ox=origin[0],$oy=origin[1],$q[0]==$p[0]?$q[1]>$p[1]?$rotateAngleRad=0:$rotateAngleRad=Math.PI:$rotateAngleRad=Math.PI/2-Math.atan(($q[1]-$p[1])*yunitlength/(($q[0]-$p[0])*xunitlength)),$q[0]<$p[0]&&($rotateAngleRad=Math.PI+$rotateAngleRad),$rotateAngleDeg=180/Math.PI*$rotateAngleRad,$triRotate=Math.round($rotateAngleDeg),"undefined"==typeof $triWidth&&($triWidth=7),"undefined"==typeof $triHeight&&($triHeight=12),$rot="rotate("+$triRotate+" "+Math.round($ox+$q[0]*xunitlength)+" "+Math.round(boardHeight-$oy-$q[1]*yunitlength)+")",$st="M "+Math.round($ox+$q[0]*xunitlength)+" "+Math.round(boardHeight-$oy-$q[1]*yunitlength)+" L "+Math.round($ox+$q[0]*xunitlength-$triWidth/2)+" "+Math.round(boardHeight-$oy+$triHeight-$q[1]*yunitlength)+" L "+Math.round($ox+$q[0]*xunitlength+$triWidth/2)+" "+Math.round(boardHeight-$oy+$triHeight-$q[1]*yunitlength)+" Z";makeSVG("path",{d:$st,transform:$rot,stroke:stroke,fill:arrowfill,id:e},svgID)}function addListeners(r){r.addEventListener("pointerdown",doOnPointerDown,!1),r.addEventListener("pointermove",doOnPointerMove,!1),r.addEventListener("pointerup",doOnPointerUp,!1)}function makeDraggable(targ,func,curveId){targID=targ.id,gebi(targID).style.strokeOpacity=.01,addListeners(targ.parentNode),brdID=targ.parentNode.id.replace("SVG","");var xunitlength=brdPropsArr[brdID].XuL,yunitlength=brdPropsArr[brdID].YuL,boardWidth=brdPropsArr[brdID].brdWidth,boardHeight=brdPropsArr[brdID].brdHeight,padding=brdPropsArr[brdID].pad,xmin=brdPropsArr[brdID].xMin,xmax=brdPropsArr[brdID].xMax,ymin=brdPropsArr[brdID].yMin,ymax=brdPropsArr[brdID].yMax,ox=brdPropsArr[brdID].ox,oy=brdPropsArr[brdID].oy,cx=brdPropsArr[brdID][targID].cx,cy=brdPropsArr[brdID][targID].cy,r=brdPropsArr[brdID][targID].r;if(void 0!==func&&"vert"!=func){var g;eval("g = function(x){ with(Math) return "+mathjs(func)+"; }");var qForGlider=g(brdPropsArr[brdID][targID].cart[0]);brdPropsArr[brdID][targID].cart[1]=qForGlider,targ.setAttribute("cy",boardHeight-oy-qForGlider*yunitlength)}var x_0=brdPropsArr[brdID][targID].cart[0];targID="",eventjs.add(targ,"drag",function(t,e){svgID=e.target.parentNode.id,brdID=svgID.replace("SVG",""),targID=targ.id;var i=brdPropsArr[brdID].brdWidth,n=brdPropsArr[brdID].brdHeight;if(gebi(svgID).appendChild(gebi(targID)),void 0===brdPropsArr[brdID][targID].trans&&(brdPropsArr[brdID][targID].trans=[0,0]),void 0===brdPropsArr[brdID][targID].transRem&&(brdPropsArr[brdID][targID].transRem=[0,0]),transX=brdPropsArr[brdID][targID].trans[0]+e.x-r,transY=brdPropsArr[brdID][targID].trans[1]+e.y-r,xPix=brdPropsArr[brdID][targID].cx+transX,yPix=cy+transY,xPix>i-padding?(xPix=i-padding,xCart=xmax,transXRem=i-padding-cx):xPix<padding?(xPix=padding,xCart=xmin,transXRem=-cx+padding):(transXRem=transX,xCart=xmin+(xPix-padding)/xunitlength),transYRem=yPix<=padding?(yPix=padding)-cy:yPix>n-padding?(yPix=n-padding)-cy:transY,d=(n-yPix-oy)/yunitlength,void 0===func&&e.target.setAttribute("transform","translate("+transXRem+","+transYRem+")"),brdPropsArr[brdID][targID].cart=[xCart,d],brdPropsArr[brdID][targID].pix=[xPix,yPix],void 0!==brdPropsArr[brdID][targID].segment&&(joinSegID=brdPropsArr[brdID][targID].segment,firstPt=brdPropsArr[brdID][joinSegID][0],secondPt=brdPropsArr[brdID][joinSegID][1],ptP=brdPropsArr[brdID][firstPt].cart,ptQ=brdPropsArr[brdID][secondPt].cart,segment(ptP,ptQ,joinSegID)),void 0!==brdPropsArr[brdID][targID].line&&(joinLineID=brdPropsArr[brdID][targID].line,firstPt=brdPropsArr[brdID][joinLineID][0],secondPt=brdPropsArr[brdID][joinLineID][1],ptP=brdPropsArr[brdID][firstPt].cart,ptQ=brdPropsArr[brdID][secondPt].cart,line(ptP,ptQ,joinLineID)),void 0!==func&&"vert"!=func){var a=(g(xCart-.01)-g(xCart))/-.01,o=a*(brdPropsArr[brdID].YuL/brdPropsArr[brdID].XuL);if(Math.abs(o)<3){var d=Math.max(ymin,Math.min(g(xCart),ymax)),i=brdPropsArr[brdID].brdWidth;transYRem=yPix<=r?r-cy:yPix>=n-r?yPix-cy:(-d+g(x_0))*yunitlength,xCart>brdPropsArr[brdID][curveId].minX&&xCart<brdPropsArr[brdID][curveId].maxX&&gebi(targID).setAttribute("transform","translate("+transXRem+","+transYRem+")")}else newXcart=xCart-(g(xCart)-d)/a,transXRem=0,transXRem=ox-cx+newXcart*xunitlength,gebi(targID).setAttribute("transform","translate("+transXRem+","+transYRem+")"),brdPropsArr[brdID][targID].cart=[newXcart,d],brdPropsArr[brdID][targID].pix=[xPix,yPix],xCart=newXcart;gebi("eventsInfo1")&&dragCnt%5==1&&(gebi("eventsInfo1").innerHTML="<b>Cartesian:</b> ("+xCart.toFixed(2)+", "+d.toFixed(2)+")")}void 0!==brdPropsArr[brdID][curveId]&&void 0!==brdPropsArr[brdID][curveId].vert&&brdPropsArr[brdID][curveId].vert[0][0]==brdPropsArr[brdID][curveId].vert[1][0]&&(xCart=brdPropsArr[brdID][curveId].vert[0][0],transXRem=0,gebi(targID).setAttribute("transform","translate("+transXRem+","+transYRem+")"),brdPropsArr[brdID][targID].cart=[xCart,d],brdPropsArr[brdID][targID].pix=[xPix,yPix],gebi("eventsInfo1")&&dragCnt%5==1&&(gebi("eventsInfo1").innerHTML="<b>Cartesian:</b> ("+xCart.toFixed(2)+", "+d.toFixed(2)+")")),brdPropsArr[brdID][targID].transRem=[transXRem,transYRem],gebi("eventsInfo0")&&dragCnt%5==0&&(gebi("eventsInfo0").innerHTML="<b>Board:</b> "+brdID+", <b>target:</b> "+targID),void 0===func&&(d=(n-yPix-oy)/yunitlength,gebi("eventsInfo1")&&dragCnt%5==1&&(gebi("eventsInfo1").innerHTML="<b>Cartesian:</b> ("+xCart.toFixed(2)+", "+d.toFixed(2)+")")),gebi("eventsInfo2")&&dragCnt%5==2&&(gebi("eventsInfo2").innerHTML="<b>Pixels:</b> ("+xPix.toFixed(1)+", "+yPix.toFixed(1)+")"),gebi("eventsInfo3")&&dragCnt%5==3&&(gebi("eventsInfo3").innerHTML="<b>self.x, self.y:</b> ("+e.x.toFixed(2)+","+e.y.toFixed(2)+")"),gebi("eventsInfo4")&&dragCnt%5==4&&(gebi("eventsInfo4").innerHTML="<b>translateRem:</b> "+brdPropsArr[brdID][targID].trans[0].toFixed(2)+", "+brdPropsArr[brdID][targID].trans[1].toFixed(2)),dragCnt++})}function Drag(r){eTarg=r.target,targetId=eTarg.id,et=r.type,mseTchPosi=mseTchPos(r);var t=r.target.parentNode.id;if(slicedSVG=t.slice(0,-3),void 0===currCartMatrix[slicedSVG][targetId]&&(currCartMatrix[slicedSVG][targetId]=[]),etTxt&&(etTxt.innerHTML=et),drag&&dragging||"mousedown"!=et&&"touchstart"!=et||(thisSVGNode=document.getElementById(t),thisSVGNode.appendChild(eTarg),"function"==typeof window.doFirstOnElementSelect&&doFirstOnElementSelect(),"draggable"==eTarg.className.baseVal&&(void 0!==(drag=eTarg)._x||resetCxCy||(drag._x=0,drag._y=0),dPoint=mseTchPosi,resetCxCy?(void 0===currCartMatrix[slicedSVG][targetId].currCx||void 0===currCartMatrix[slicedSVG][targetId].currCy||void 0===currCartMatrix[slicedSVG][targetId].transX||void 0===currCartMatrix[slicedSVG][targetId].transY||null==eTarg.getAttribute("transform")?(currCartMatrix[slicedSVG][targetId].currCx=Number(eTarg.getAttribute("cx")),currCartMatrix[slicedSVG][targetId].currCy=Number(eTarg.getAttribute("cy"))):(currCartMatrix[slicedSVG][targetId].currCx=Number(eTarg.getAttribute("cx"))+Number(currCartMatrix[slicedSVG][targetId].transX),currCartMatrix[slicedSVG][targetId].currCy=Number(eTarg.getAttribute("cy"))+Number(currCartMatrix[slicedSVG][targetId].transY),eTarg.removeAttribute("transform"),eTarg.setAttribute("cx",currCartMatrix[slicedSVG][targetId].currCx),(e=eTarg.getAttribute("data-gliderOn"))?eTarg.setAttribute("cy",boardPropsArr[slicedSVG+"Height"]-boardPropsArr[slicedSVG+"oy"]+Number(e)*boardPropsArr[slicedSVG+"YuL"]):eTarg.setAttribute("cy",currCartMatrix[slicedSVG][targetId].currCy)),drag._x=0,drag._y=0):(dPoint={x:mseTchPosi.x-drag.getCTM().e,y:mseTchPosi.y-drag.getCTM().f},currCartMatrix[slicedSVG][targetId].currCx=Number(eTarg.getAttribute("cx")),currCartMatrix[slicedSVG][targetId].currCy=Number(eTarg.getAttribute("cy")),drag._x=0,drag._y=0)),"function"==typeof window.doAfterElementSelect&&doAfterElementSelect()),drag&&("mousemove"==et||"touchmove"==et))if(mseTchPosi.x>4&&mseTchPosi.x<boardPropsArr[slicedSVG+"Width"]-4&&mseTchPosi.y>4&&mseTchPosi.y<boardPropsArr[slicedSVG+"Height"]-4){drag._x+=mseTchPosi.x-dPoint.x;var e=eTarg.getAttribute("data-gliderOn");e?drag._y=Number(e):drag._y+=mseTchPosi.y-dPoint.y,(Math.abs(drag._x)>0||Math.abs(drag._y)>0)&&(dragging=!0,dPoint=mseTchPosi,drag.setAttribute("transform","translate("+drag._x+","+drag._y+")"),currCartMatrix[slicedSVG][targetId].transX=drag._x,currCartMatrix[slicedSVG][targetId].transY=drag._y,targetId.length>0&&-1==targetId.indexOf("board")&&(xCart=(mseTchPosi.x-padding)/boardPropsArr[slicedSVG+"XuL"]+boardPropsArr[slicedSVG+"xMin"],yCart=(boardPropsArr[slicedSVG+"Height"]-mseTchPosi.y-boardPropsArr[slicedSVG+"oy"])/boardPropsArr[slicedSVG+"YuL"],currCartMatrix[slicedSVG][targetId].xCart=xCart,currCartMatrix[slicedSVG][targetId].yCart=yCart,"function"==typeof window.doOnElementDrag&&doOnElementDrag()))}else drag=null;drag&&"mouseup"==et&&(drag="undefined",dragging=!1,"function"==typeof window.doOnDeselectElement&&doOnDeselectElement()),drag&&"mouseout"==et&&(drag=null,dragging=!1,"function"==typeof window.doOnMouseOut&&doOnMouseOut())}function mseTchPos(r){var t=r.target.parentNode.id;slicedSVG=t.slice(0,-3);var e=document.getElementById(t).createSVGPoint();isTouch||void 0!==r.touches?(e.x=r.touches[0].clientX,e.y=r.touches[0].clientY):(e.x=r.clientX,e.y=r.clientY);var i=document.getElementById(t).getScreenCTM();return e=e.matrixTransform(i.inverse()),{x:e.x,y:e.y}}function ASdot(r,t,e,i,n){setBoardParams(brdID),slicedSVG=svgID.slice(0,-3),brdPropsArr[slicedSVG][n]=[],brdPropsArr[slicedSVG][n].cart=r;var a;if(null==e&&(e=stroke),null==i&&(i=fill),null!=n&&(a=doc.getElementById(n)),null==a&&(cx=r[0]*xunitlength+origin[0],cy=boardHeight-r[1]*yunitlength-origin[1],a=makeSVG("circle",{id:n,cx:cx.toFixed(2),cy:cy.toFixed(2),r:t,stroke:e,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:i,"fill-opacity":fillopacity},svgID),brdPropsArr[slicedSVG][n].cx=cx,brdPropsArr[slicedSVG][n].cy=cy,brdPropsArr[slicedSVG][n].r=t),dotDraggable){slicedSVG=svgID.slice(0,-3),a.setAttribute("class","draggable"),gliderOn.length>0&&a.setAttribute("data-gliderOn",gliderOn),thisXunitLen=boardPropsArr[slicedSVG+"XuL"],thisYunitLen=boardPropsArr[slicedSVG+"YuL"],thisPadding=boardPropsArr[slicedSVG+"pad"],thisXmin=boardPropsArr[slicedSVG+"xMin"],thisOy=boardPropsArr[slicedSVG+"oy"],thisHeight=boardPropsArr[slicedSVG+"Height"];var o=r[0],d=r[1];void 0===currCartMatrix[slicedSVG]&&(currCartMatrix[slicedSVG]=[]),void 0===currCartMatrix[slicedSVG][a.id]&&(currCartMatrix[slicedSVG][a.id]=[]),currCartMatrix[slicedSVG][a.id].xCart=o,currCartMatrix[slicedSVG][a.id].yCart=d,a.onmousedown=Drag,a.onmousemove=Drag,a.onmouseup=Drag,a.onmouseout=Drag,a.addEventListener("touchstart",function(r){r.preventDefault&&r.preventDefault(),isTouch=!0,Drag(r)},!1),a.addEventListener("touchmove",function(r){r.preventDefault&&r.preventDefault(),Drag(r)},!1),a.addEventListener("touchend",function(r){r.preventDefault&&r.preventDefault(),drag=null,"function"==typeof window.doOnDeselectElement&&doOnDeselectElement()},!1)}return gebi(n)}function circle(r,t,e){ellipse(r,t,t,e)}function dot(r,t,e,i,n){var a,o=r[0]*xunitlength+origin[0],d=boardHeight-r[1]*yunitlength-origin[1];null!=n&&(a=doc.getElementById(n)),"+"==t||"-"==t||"|"==t?(null==a&&(a=makeSVG("path",{id:n},svgID)),"+"==t?(a.setAttribute("d"," M "+(o-ticklength)+" "+d+" L "+(o+ticklength)+" "+d+" M "+o+" "+(d-ticklength)+" L "+o+" "+(d+ticklength)),a.setAttribute("stroke-width",1),a.setAttribute("stroke",axesstroke)):("-"==t?a.setAttribute("d"," M "+(o-ticklength)+" "+d+" L "+(o+ticklength)+" "+d):a.setAttribute("d"," M "+o+" "+(d-ticklength)+" L "+o+" "+(d+ticklength)),a.setAttribute("stroke-width",strokewidth),a.setAttribute("stroke",stroke))):(null==a&&(a=makeSVG("circle",{id:n},svgID)),a.setAttribute("cx",o),a.setAttribute("cy",d),a.setAttribute("r",dotradius),a.setAttribute("stroke-width",strokewidth),a.setAttribute("stroke",stroke),a.setAttribute("fill","open"==t?"white":stroke)),null!=e&&e.length>0&&text(r,e,null==i?"below":i,null==n?n:n+"label"),void 0===brdPropsArr[brdID][n]&&(brdPropsArr[brdID][n]=[],brdPropsArr[brdID][n].cart=[]),brdPropsArr[brdID][n].cart=r}function ellipse(r,t,e,i){var n;null!=i&&(n=doc.getElementById(i)),null==n&&(n=makeSVG("ellipse",{id:i,cx:(r[0]*xunitlength+origin[0]).toFixed(2),cy:(boardHeight-r[1]*yunitlength-origin[1]).toFixed(2),rx:t*xunitlength,ry:e*yunitlength,stroke:stroke,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:fill,"fill-opacity":fillopacity},svgID))}function draggablePtsSegLineJoiner(r,t,e,i){brdPropsArr[brdID][r]=i,strokewidth=segstrokewidth,"segment"==t?segment(e[0],e[1],r):line(e[0],e[1],r),gebi(svgID).appendChild(gebi(r)),strokewidth=dotstrokewidth,ASdot(e[0],dotradius,stroke,fill,i[0]),ASdot(e[1],dotradius,stroke,fill,i[1]),brdPropsArr[brdID][i[0]][t]=r,brdPropsArr[brdID][i[1]][t]=r,gebi(i[0]).setAttribute("join-"+t,r),gebi(i[1]).setAttribute("join-"+t,r),makeDraggable(gebi(i[0])),makeDraggable(gebi(i[1]))}function line(r,t,e,i){setBoardParams(svgID);var n;e?n=doc.getElementById(e):e=svgID+"-line-"+ ++elementIdNum,null==n&&(n=makeSVG("path",{id:e,stroke:stroke,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:fill,"fill-opacity":fillopacity,"vector-effect":"non-scaling-stroke"},svgID)),null!=i&&n.setAttribute("stroke-dasharray",i),null!=shaperendering&&n.setAttribute("shape-rendering",shaperendering);var a=brdPropsArr[brdID].xMin,o=brdPropsArr[brdID].xMax,d=brdPropsArr[brdID].actualXmin,s=brdPropsArr[brdID].actualXmax,l=brdPropsArr[brdID].yMin,g=brdPropsArr[brdID].yMax,x=brdPropsArr[brdID].actualYmin,c=brdPropsArr[brdID].actualYmax;if(r[0]==t[0])goToExtremities?(pStart=[r[0],x],pEnd=[r[0],c]):(pStart=[r[0],l],pEnd=[r[0],g]),r=pStart,t=pEnd,void 0===brdPropsArr[brdID][e]&&(brdPropsArr[brdID][e]=[],brdPropsArr[brdID][e].vert=[r,t]);else if(r[1]==t[1])goToExtremities?(pStart=[d,r[1]],pEnd=[s,t[1]]):(pStart=[a,r[1]],pEnd=[o,t[1]]);else{var u=(t[1]-r[1])/(t[0]-r[0]);if(goToExtremities){if(yValueAtActualXmin=u*(d-r[0])+r[1],yValueAtActualXmin>x&&yValueAtActualXmin<c){b=d;pStart=[b,yValueAtActualXmin]}else{b=(x-r[1])/u+r[0];pStart=[b,x]}if(yValueAtActualXmax=u*(s-t[0])+t[1],yValueAtActualXmax>x&&yValueAtActualXmax<c){h=s;pEnd=[h,yValueAtActualXmax]}else{h=(c-t[1])/u+t[0];pEnd=[h,c]}}else{if(yValueAtXmin=u*(a-r[0])+r[1],yValueAtXmin>l&&yValueAtXmin<g){b=a;pStart=[b,yValueAtXmin]}else if(u>0){b=(l-r[1])/u+r[0];pStart=[b,l]}else{var b=(g-r[1])/u+r[0];pStart=[b,g]}if(yValueAtXmax=u*(o-t[0])+t[1],yValueAtXmax>l&&yValueAtXmax<g){h=o;pEnd=[h,yValueAtXmax]}else if(u>0){h=(g-t[1])/u+t[0];pEnd=[h,g]}else{var h=(l-t[1])/u+t[0];pEnd=[h,l]}}r=pStart,t=pEnd}return n.setAttribute("d","M"+(r[0]*xunitlength+origin[0])+","+(boardHeight-r[1]*yunitlength-origin[1])+" "+(t[0]*xunitlength+origin[0])+","+(boardHeight-t[1]*yunitlength-origin[1])),n}function segment(r,t,e,i){if(setBoardParams(svgID),r[0]>actualXmin&&r[0]<actualXmax&&r[1]>actualYmin&&r[1]<actualYmax||t[0]>actualXmin&&t[0]<actualXmax&&t[1]>actualYmin&&t[1]<actualYmax||(r[0]+t[0])/2>actualXmin&&(r[0]+t[0])/2<actualXmax||(r[1]+t[1])/2>actualYmin&&(r[1]+t[1])/2<actualYmax){var n;return e?n=doc.getElementById(e):e=svgID+"-seg-"+ ++elementIdNum,null==n&&(n=makeSVG("path",{id:e,stroke:stroke,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:fill,"fill-opacity":fillopacity,"stroke-dasharray":i,"vector-effect":"non-scaling-stroke"},svgID)),null!=i&&n.setAttribute("stroke-dasharray",i),null!=shaperendering&&n.setAttribute("shape-rendering",shaperendering),slopeAng=arctan((t[1]-r[1])/(t[0]-r[0])),"dotdot"==marker||"dotarrow"==marker||"dot"==marker||"arrowdot"==marker?("undefined"!=typeof firstDotClosed&&1==firstDotClosed?(mrkrfill=corpColor,fillopacity=1):(mrkrfill="none",fillopacity=0),"dotdot"!=marker&&"dotarrow"!=marker&&"dot"!=marker||ASdot(r,markersize,markerstroke,mrkrfill),fillopacity=1,dotSpacerX=markersize*cos(slopeAng),dotSpacerY=markersize*sin(slopeAng),"dotdot"!=marker&&"arrowdot"!=marker||ASdot(t,markersize,markerstroke,markerfill),"dotarrow"!=marker&&"arrowdot"!=marker||("dotarrow"==marker?arrowhead(r,t):(dotSpacerX+=4*Math.cos(slopeAng),dotSpacerY+=4*Math.sin(slopeAng),r[0]>t[0]&&(dotSpacerX=-dotSpacerX,dotSpacerY=-dotSpacerY),arrowhead(r,[t[0]-dotSpacerX/xunitlength,t[1]-dotSpacerY/yunitlength])))):"arrow"==marker?(arrowhead(r,t,e+"-ah"),dotSpacerX=0,dotSpacerY=0):dotSpacerX=dotSpacerY=0,n.setAttribute("d","M"+(r[0]*xunitlength+origin[0]+dotSpacerX)+","+(boardHeight-r[1]*yunitlength-origin[1]-dotSpacerY)+" "+(t[0]*xunitlength+origin[0]-dotSpacerX)+","+(boardHeight-t[1]*yunitlength-origin[1]+dotSpacerY)),n}}function path(r,t,e){setBoardParams(svgID),null==e&&(e="");var i,n,a;if(null!=t?i=doc.getElementById(t):t=svgID+"-path-"+ ++elementIdNum,null==i&&(i=makeSVG("path",{id:t,stroke:stroke,"stroke-width":strokewidth,"stroke-opacity":strokeopacity,fill:fill,"fill-opacity":fillopacity,"vector-effect":"non-scaling-stroke"},svgID)),"string"==typeof r)n=r;else{for(n="M",curveLengthCart=0,curveLengthPix=0,a=0;a<r.length;a++)r[a][1]>brdPropsArr[brdID].actualYmin-.01&&r[a][1]<brdPropsArr[brdID].actualYmax+.01&&(n+=(r[a][0]*xunitlength+origin[0]).toFixed(2)+","+(boardHeight-r[a][1]*yunitlength-origin[1]).toFixed(2)+" ",a>1&&(curveLengthCart+=pythag([r[a-1][0],r[a-1][1]],[r[a][0],r[a][1]]),curveLengthPix+=pythag([r[a-1][0]*xunitlength+origin[0],boardHeight-r[a-1][1]*yunitlength-origin[1]],[r[a][0]*xunitlength+origin[0],boardHeight-r[a][1]*yunitlength-origin[1]])));void 0===brdPropsArr[brdID][t]&&(brdPropsArr[brdID][t]=[]),brdPropsArr[brdID][t].curveLenCart=curveLengthCart,brdPropsArr[brdID][t].curveLenPix=curveLengthPix}if(i.setAttribute("d",n),i.setAttribute("stroke-width",strokewidth),void 0!==opacity&&i.setAttribute("opacity",opacity),i.setAttribute("vector-effect","non-scaling-stroke"),null!=strokedasharray&&i.setAttribute("stroke-dasharray",strokedasharray),null!=strokedashoffset&&i.setAttribute("stroke-dashoffset",strokedashoffset),"dot"==marker||"arrowdot"==marker)for(a=0;a<r.length;a++)("C"!=e&&"T"!=e||1!=a&&2!=a)&&ASdot(r[a],markersize,markerstroke,markerfill)}function plot(fun,x_min,x_max,points,id){pth=[],f=function(r){return r},g=fun;var name=null;null!=id?(removeEle(id),removeEle(id+"-0"),removeEle(id+"-1")):(elementIdNum++,id=svgID+"-plot-"+elementIdNum);var idInc=0,graphFn=[],q=[];brdID=boundingDiv.id;var xDomain=brdPropsArr[brdID].xMax-brdPropsArr[brdID].xMin,actualXmin=brdPropsArr[brdID].actualXmin,actualXmax=brdPropsArr[brdID].actualXmax,yRange=brdPropsArr[brdID].yMax-brdPropsArr[brdID].yMin,actualYmin=brdPropsArr[brdID].actualYmin,actualYmax=brdPropsArr[brdID].actualYmax,extendAmt=.25,plotYmin=actualYmin-extendAmt*yRange,plotYmax=actualYmax+extendAmt*yRange;if("string"==typeof fun&&fun.indexOf("y")>-1){"string"==typeof fun?eval("g = function(y){ with(Math) return "+mathjs(fun)+"; }"):"object"==typeof fun&&(eval("f = function(t){ with(Math) return "+mathjs(fun[0])+" }"),eval("g = function(t){ with(Math) return "+mathjs(fun[1])+" }")),"string"==typeof x_min?(name=x_min,x_min=xmin):name=id;var min=null==x_min?xmin:x_min,max=null==x_max?xmax:x_max,inc=max-min-1e-6*(max-min);inc=null==points?inc/200:inc/points;for(var gt,t=min;t<=max;t+=inc)gt=g(t),pth.push([gt,f(t)])}else{"string"==typeof fun?eval("g = function(x){ with(Math) return "+mathjs(fun)+"; }"):"number"==typeof fun?eval("g = function(x){ return "+fun+"; }"):"object"==typeof fun&&(eval("f = function(t){ with(Math) return "+mathjs(fun[0])+"; }"),eval("g = function(t){ with(Math) return "+mathjs(fun[1])+"; }")),plotBeyondXVis?(xPlotMin=x_min,xPlotMax=x_max):(xPlotMin=Math.max(actualXmin,x_min),xPlotMax=Math.min(actualXmax,x_max));var min=1*(null==x_min?xmin:xPlotMin),max=1*(null==x_max?xmax:xPlotMax),gt,gtRem=g(min),slopRem=0,plotIt=!1,plotted=!1,changeSigns=!1,xDomain=max-min,slop=0,dom=.999999*xDomain,inc=null==points?dom/250:dom/points;gtPrevPix=boardHeight-(origin[1]+g(min-inc)*yunitlength),gtPix=boardHeight-(origin[1]+g(min)*yunitlength),gtNextPix=boardHeight-(origin[1]+g(min+inc)*yunitlength);var slopNextPix=(gtPix-gtNextPix)/inc;for(slopPixRem=(gtPix-gtPrevPix)/inc,pushFlag=!1,slopSwingFlag=!1,void 0===brdPropsArr[brdID][id]&&(brdPropsArr[brdID][id]=[]),brdPropsArr[brdID][id].minX=1e9,brdPropsArr[brdID][id].maxX=-1e9,brdPropsArr[brdID][id].minY=1e9,brdPropsArr[brdID][id].maxY=-1e9,plotBeyondYVis||(actualYmax=ymax,actualYmin=ymin),colorsArr=["#f08","#0f8","#8f0","#f80","#08f","#80f","#338","#f8f","#f00","#0f0","#f0f","#5f5","#f08","#0f8","#8f0","#f80","#08f","#80f","#338","#f8f","#f00","#0f0","#f0f","#5f5","#f08","#0f8","#8f0","#f80","#08f","#80f","#338","#f8f","#f00","#0f0","#f0f","#5f5"],t=min;t<max;t+=inc){if(0!==t&&-1==sign(t)&&1==sign(t+inc)&&-1==sign(t)&&(t=-1e-12),0!==t&&-1==sign(t-inc)&&1==sign(t)&&1==sign(t)&&(t=1e-10),gtPrev=g(t-inc),gt=g(t),gtNext=g(t+inc),gtNextNext=g(t+2*inc),slopCart=(gtRem-gt)/inc,gtPrevPix=boardHeight-(origin[1]+gtPrev*yunitlength),gtPix=boardHeight-(origin[1]+gt*yunitlength),gtNextPix=boardHeight-(origin[1]+gtNext*yunitlength),slopPrevPix=(gtPrevPix-gtPix)/inc,slopNextPix=(gtPix-gtNextPix)/inc,gtIsNum=!isNaN(gt)&&"Infinity"!=Math.abs(gt),gtisLessPlotYmin=gt<plotYmin,gtBetweenMins=gt>plotYmin&&gt<actualYmin,aveMins=.5*(plotYmin+actualYmin),gtPrevVis=gtPrev>actualYmin&&gtPrev<actualYmax,gtVis=gt>actualYmin&&gt<actualYmax,gtNextVis=gtNext>actualYmin&&gtNext<actualYmax,gtBetweenMaxs=gt>actualYmax&&gt<plotYmax,gtisMorePlotYmax=gt>plotYmax,aveMaxs=.5*(actualYmax+plotYmax),slopSwingFlag=!1,Math.abs(slopPrevPix)>500&&Math.abs(slopNextPix)>500&&Math.sign(slopPrevPix)!=Math.sign(slopNextPix)&&(slopSwingFlag=!0),!slopSwingFlag&&(slopNextPix>=0&&gt>plotYmin&&gt<plotYmax&&(gtPrevVis||gtNextVis)||slopNextPix<0&&(gtPrevVis||gtNextVis)&&gt>plotYmin-.3*yRange&&gt<plotYmax)&&(pth.push([f(t),gt]),brdPropsArr[brdID][id].minX=Math.min(brdPropsArr[brdID][id].minX,f(t)).toFixed(6),brdPropsArr[brdID][id].maxX=Math.max(brdPropsArr[brdID][id].maxX,f(t)).toFixed(6),brdPropsArr[brdID][id].minY=Math.min(brdPropsArr[brdID][id].minY,gt).toFixed(6),brdPropsArr[brdID][id].maxY=Math.max(brdPropsArr[brdID][id].maxY,gt).toFixed(6),pushFlag=!0),slopSwingFlag&&1==pth.length&&pth.pop(),1==pth.length&&(slopNextPix>200&&gt>actualYmin&&gtPrev<actualYmin||slopPrevPix<-200&&gt<actualYmax&&gtPrev>actualYmax))for(k=t;k>t-inc-inc/10;k-=inc/10)gk=g(k),Math.sign(gk-g(k+inc))==Math.sign(gt-g(t+inc))&&gk>actualYmin-.01*yRange&&gk<actualYmax+.01*yRange&&pushFlag&&(pth.unshift([k,gk]),brdPropsArr[brdID][id].minX=Math.min(brdPropsArr[brdID][id].minX,k).toFixed(6),brdPropsArr[brdID][id].maxX=Math.max(brdPropsArr[brdID][id].maxX,k).toFixed(6),brdPropsArr[brdID][id].minY=Math.min(brdPropsArr[brdID][id].minY,gk).toFixed(6),brdPropsArr[brdID][id].maxY=Math.max(brdPropsArr[brdID][id].maxY,gk).toFixed(6));if(slopNextPix>300&&gtVis&&!gtNextVis)for(k=t;k<t+inc;k+=inc/10)gk=g(k),pushFlag&&gk>actualYmin-.2*yRange&&gk<actualYmax+.2*yRange&&(pth.push([k,gk]),brdPropsArr[brdID][id].minX=Math.min(brdPropsArr[brdID][id].minX,k).toFixed(6),brdPropsArr[brdID][id].maxX=Math.max(brdPropsArr[brdID][id].maxX,k).toFixed(6),brdPropsArr[brdID][id].minY=Math.min(brdPropsArr[brdID][id].minY,gk).toFixed(6),brdPropsArr[brdID][id].maxY=Math.max(brdPropsArr[brdID][id].maxY,gk).toFixed(6),!isNaN(gk)&&"Infinity"!=Math.abs(gk)&&gk>actualYmax&&pushFlag&&pth.length>3&&Math.sign(gk-g(k+inc))==Math.sign(gt-g(t-inc))&&pth.length>1&&(path(pth,id+idInc),plotted=!0,pth=[],idInc++,t+=inc,pushFlag=!1,slopSwingFlag=!1));if(slopPrevPix>700&&gtVis&&gt>actualYmin-.25*yRange&&!gtPrevVis)for(k=t;k>t-inc-inc/10;k-=inc/10)gk=g(k),pushFlag&&gk>actualYmin-.2*yRange&&gk<actualYmax&&(pth.unshift([k,gk]),brdPropsArr[brdID][id].minX=Math.min(brdPropsArr[brdID][id].minX,k).toFixed(6),brdPropsArr[brdID][id].maxX=Math.max(brdPropsArr[brdID][id].maxX,k).toFixed(6),brdPropsArr[brdID][id].minY=Math.min(brdPropsArr[brdID][id].minY,gk).toFixed(6),brdPropsArr[brdID][id].maxY=Math.max(brdPropsArr[brdID][id].maxY,gk).toFixed(6));if(slopPrevPix<-700&&gtVis&&gt<actualYmax-.5*yRange&&gt>actualYmin-.25*yRange&&!gtNextVis)for(k=t;k<t+inc;k+=inc/10)gk=g(k),pushFlag&&gk>actualYmin-.5&&gk<actualYmax&&(pth.push([k,gk]),brdPropsArr[brdID][id].minX=Math.min(brdPropsArr[brdID][id].minX,k).toFixed(6),brdPropsArr[brdID][id].maxX=Math.max(brdPropsArr[brdID][id].maxX,k).toFixed(6),brdPropsArr[brdID][id].minY=Math.min(brdPropsArr[brdID][id].minY,gk).toFixed(6),brdPropsArr[brdID][id].maxY=Math.max(brdPropsArr[brdID][id].maxY,gk).toFixed(6),!isNaN(gk)&&"Infinity"!=Math.abs(gk)&&(gk>actualYmax||gk<actualYmin-.2*yRange)&&pushFlag&&pth.length>3&&(path(pth,id+idInc),plotted=!0,pth=[],idInc++,t+=inc,pushFlag=!1,slopSwingFlag=!1));pth.length>1&&(slopSwingFlag||slopNextPix>0&&gtNext>actualYmax+.2*yRange&&pushFlag)&&(path(pth,id+idInc),plotted=!0,pth=[],idInc++,slopSwingFlag&&(slopSwingFlag=!1)),pth.length>1&&(slopSwingFlag||slopNextPix<0&&gtPrev<actualYmin&&pushFlag)&&(path(pth,id+idInc),plotted=!0,pth=[],idInc++,slopSwingFlag&&(slopSwingFlag=!1))}}pth.length>1?(path(pth,id),pth=[]):!1===plotted&&console.log("There are no points to plot. Are your xMin, xMax and yMin, yMax positioned correctly?")}function polygon(r,t){var e;null!=t?e=doc.getElementById(t):t=svgID+"-rect-"+ ++elementIdNum,null==e&&(e=makeSVG("polygon",{id:t},svgID));for(var i="",n=0;n<r.length;n++)i+=(r[n][0]*xunitlength+origin[0]).toFixed(2)+","+(boardHeight-r[n][1]*yunitlength-origin[1]).toFixed(2)+" ";e.setAttribute("points",i),e.setAttribute("stroke-width",strokewidth),e.setAttribute("stroke-opacity",strokeopacity),e.setAttribute("stroke",stroke),e.setAttribute("fill",fill),e.setAttribute("fill-opacity",fillopacity)}function rect(r,t,e,i,n){var a;null!=e?a=doc.getElementById(e):e=svgID+"-rect-"+ ++elementIdNum,null==a&&(a=makeSVG("rect",{id:e},svgID)),a.setAttribute("x",(r[0]*xunitlength+origin[0]).toFixed(2)),a.setAttribute("y",(boardHeight-t[1]*yunitlength-origin[1]).toFixed(2)),a.setAttribute("width",((t[0]-r[0])*xunitlength).toFixed(2)),a.setAttribute("height",((t[1]-r[1])*yunitlength).toFixed(2)),null!=i&&a.setAttribute("rx",(i*xunitlength).toFixed(2)),null!=n&&a.setAttribute("ry",(n*yunitlength).toFixed(2)),a.setAttribute("stroke-width",strokewidth),a.setAttribute("stroke",stroke),a.setAttribute("fill",fill),a.setAttribute("fill-opacity",fillopacity)}function strip_tags(r){var t=document.createElement("DIV");return t.innerHTML=r,t.textContent||t.innerText}function text(r,t,e,i,n,a){var o="middle",d=0,s=fontsize/3;if(null!=e&&("above"==e.slice(0,5)&&(s=-fontsize/2),"below"==e.slice(0,5)&&(s=fontsize+0),"right"!=e.slice(0,5)&&"right"!=e.slice(5,10)||(o="start",d=fontsize/2),"left"!=e.slice(0,4)&&"left"!=e.slice(5,9)||(o="end",d=-fontsize/2)),strTxt=strip_tags(t),isNaN(t)&&t.length!=strTxt.length)newDiv=document.createElement("div"),newDiv.id=i,newDiv.className="svgHtml intmath",newDiv.setAttribute("style","position:absolute;top:"+Math.round(boardHeight-r[1]*yunitlength-origin[1]-padding+s)+"px;left:"+Math.round(r[0]*xunitlength+origin[0]+d-5)+"px;"+n),"&nbsp;"==t&&(t=""),newDiv.innerHTML=t,boundingDiv.appendChild(newDiv);else{var l;null!=i?l=document.getElementById(i):i=svgID+"-text-"+ ++elementIdNum,null==l&&(l=makeSVG("text",{id:i},svgID)),l.textContent=strTxt,l.setAttribute("x",(r[0]*xunitlength+origin[0]+d).toFixed(2)),l.setAttribute("y",(boardHeight-r[1]*yunitlength-origin[1]+s).toFixed(2)),null!=n&&l.setAttribute("style",null!=n&&void 0!==n?n:fontstyle),l.setAttribute("class",txtLabelsClass),i.indexOf("AxVbl")>-1?fs=16:fs=fontsize,l.setAttribute("style","font-size:"+fs+"px"),l.setAttribute("font-weight",fontweight),l.setAttribute("text-anchor",o),"none"!=fontstroke&&l.setAttribute("stroke",fontstroke),"none"!=fontfill&&l.setAttribute("fill",fontfill)}return r}function chopZ(r){var t=r.indexOf(".");if(-1==t)return r;for(var e=r.length-1;e>t&&"0"==r.charAt(e);e--);return e==t&&e--,r.slice(0,e+1)}function mathjs(r){-1!=(r=r.replace(/\s/g,"")).indexOf("log")&&(r=r.replace(/log/g,"logten")),-1!=r.indexOf("^-1")&&(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=r.replace(/sin\^-1/g,"arcsin")).replace(/cos\^-1/g,"arccos")).replace(/tan\^-1/g,"arctan")).replace(/sec\^-1/g,"arcsec")).replace(/csc\^-1/g,"arccsc")).replace(/cot\^-1/g,"arccot")).replace(/sinh\^-1/g,"arcsinh")).replace(/cosh\^-1/g,"arccosh")).replace(/tanh\^-1/g,"arctanh")).replace(/sech\^-1/g,"arcsech")).replace(/csch\^-1/g,"arccsch")).replace(/coth\^-1/g,"arccoth")),r=(r=(r=(r=(r=r.replace(/^e$/g,"(E)")).replace(/^e([^a-zA-Z])/g,"(E)$1")).replace(/([^a-zA-Z])e([^a-zA-Z])/g,"$1(E)$2")).replace(/([0-9])([\(a-zA-Z])/g,"$1*$2")).replace(/\)([\(0-9a-zA-Z])/g,")*$1");for(var t,e,i,n,a;-1!=(t=r.indexOf("^"));){if(0==t)return"Error: missing argument";if(e=t-1,(n=r.charAt(e))>="0"&&n<="9"){for(e--;e>=0&&(n=r.charAt(e))>="0"&&n<="9";)e--;if("."==n)for(e--;e>=0&&(n=r.charAt(e))>="0"&&n<="9";)e--}else if(")"==n){for(a=1,e--;e>=0&&a>0;)"("==(n=r.charAt(e))?a--:")"==n&&a++,e--;for(;e>=0&&(n=r.charAt(e))>="a"&&n<="z"||n>="A"&&n<="Z";)e--}else{if(!(n>="a"&&n<="z"||n>="A"&&n<="Z"))return"Error: incorrect syntax in "+r+" at position "+e;for(e--;e>=0&&(n=r.charAt(e))>="a"&&n<="z"||n>="A"&&n<="Z";)e--}if(t==r.length-1)return"Error: missing argument";if(i=t+1,(n=r.charAt(i))>="0"&&n<="9"||"-"==n){for(i++;i<r.length&&(n=r.charAt(i))>="0"&&n<="9";)i++;if("."==n)for(i++;i<r.length&&(n=r.charAt(i))>="0"&&n<="9";)i++}else if("("==n)for(a=1,i++;i<r.length&&a>0;)"("==(n=r.charAt(i))?a++:")"==n&&a--,i++;else{if(!(n>="a"&&n<="z"||n>="A"&&n<="Z"))return"Error: incorrect syntax in "+r+" at position "+i;for(i++;i<r.length&&(n=r.charAt(i))>="a"&&n<="z"||n>="A"&&n<="Z";)i++}r=r.slice(0,e+1)+"pow("+r.slice(e+1,t)+","+r.slice(t+1,i)+")"+r.slice(i)}for(;-1!=(t=r.indexOf("!"));){if(0==t)return"Error: missing argument";if(e=t-1,(n=r.charAt(e))>="0"&&n<="9"){for(e--;e>=0&&(n=r.charAt(e))>="0"&&n<="9";)e--;if("."==n)for(e--;e>=0&&(n=r.charAt(e))>="0"&&n<="9";)e--}else if(")"==n){for(a=1,e--;e>=0&&a>0;)"("==(n=r.charAt(e))?a--:")"==n&&a++,e--;for(;e>=0&&(n=r.charAt(e))>="a"&&n<="z"||n>="A"&&n<="Z";)e--}else{if(!(n>="a"&&n<="z"||n>="A"&&n<="Z"))return"Error: incorrect syntax in "+r+" at position "+e;for(e--;e>=0&&(n=r.charAt(e))>="a"&&n<="z"||n>="A"&&n<="Z";)e--}r=r.slice(0,e+1)+"factorial("+r.slice(e+1,t)+")"+r.slice(t+1)}return r}function resizeThrottler(){resizeTimeout||(resizeTimeout=setTimeout(function(){resizeTimeout=null,"function"==typeof actualResizeHandler&&actualResizeHandler()},200))}function axes(dx,dy,labels,gdx,gdy){var nanObj={dx:dx,dy:dy,gdx:gdx};for(var name in nanObj)if(isNaN(nanObj[name])||void 0===nanObj[name])return void console.log(name+" is not a number! Aborting...");null==dx&&null==dy&&(doAxes=0),null==gdx&&null==gdy&&(doGrids=0);var x,y,ldx,ldy,lx,ly,lxp,lyp,pnode,st;if(dx=null==dx?xunitlength:dx*xunitlength,dy=null==dy?dx:dy*yunitlength,fontsize=Math.max(12,Math.min(dx/2,dy/2,fontsize)),ticklength=fontsize/4,1==doGrids){if(gdx="string"==typeof gdx?dx:gdx*xunitlength,gdy=null==gdy?dy:gdy*yunitlength,pnode=document.createElementNS("http://www.w3.org/2000/svg","path"),st="",!(null!==gdx&&0!==gdx&&gdx>0))return void console.log("Is your gdx null or otherwise strange? Aborting...");for(x=origin[0];x<boardWidth;x+=gdx)st+=" M"+x.toFixed(2)+",0 "+x.toFixed(2)+","+boardHeight.toFixed(2);for(x=origin[0]-gdx;x>0;x-=gdx)st+=" M"+x.toFixed(2)+",0 "+x.toFixed(2)+","+boardHeight.toFixed(2);if(!(null!==gdy&&0!==gdy&&gdy>0))return void console.log("Is your yMax less than your yMin? Aborting...");if(1==showYaxis){if(gdy>0)for(y=boardHeight-origin[1];y<boardHeight-.99*padding;y+=gdy)st+=" M0,"+y.toFixed(2)+" "+boardWidth+","+y.toFixed(2);for(y=boardHeight-origin[1]-gdy;y>.99*padding;y-=gdy)st+=" M0,"+y.toFixed(2)+" "+boardWidth+","+y.toFixed(2)}pnode.setAttribute("d",st),pnode.setAttribute("stroke-width",1),pnode.setAttribute("shape-rendering","crispEdges"),pnode.setAttribute("stroke",gridstroke),pnode.setAttribute("fill",fill),theSVG.appendChild(pnode)}if(1==doAxes){if(st="",pnode=document.createElementNS("http://www.w3.org/2000/svg","path"),st+="M0,"+(boardHeight-origin[1]).toFixed(2)+" "+boardWidth.toFixed(2)+","+(boardHeight-origin[1]).toFixed(2),1==showYaxis&&(st+=" M"+origin[0].toFixed(2)+",0 "+origin[0].toFixed(2)+","+boardHeight.toFixed(2)),null!==dx&&dx>0){for(x=origin[0]+dx;x<boardWidth;x+=dx)st+=" M"+x.toFixed(2)+","+(boardHeight-origin[1]+ticklength).toFixed(2)+" "+x.toFixed(2)+","+(boardHeight-origin[1]-ticklength).toFixed(2);for(x=origin[0]-dx;x>0;x-=dx)st+=" M"+x.toFixed(2)+","+(boardHeight-origin[1]+ticklength).toFixed(2)+" "+x.toFixed(2)+","+(boardHeight-origin[1]-ticklength).toFixed(2);0==showYaxis&&(st+=" M"+origin[0].toFixed(2)+","+(boardHeight-origin[1]+ticklength).toFixed(2)+" "+origin[0].toFixed(2)+", "+(boardHeight-origin[1]-ticklength).toFixed(2))}if(null!==dy&&dy>0&&1==showYaxis){for(y=boardHeight-origin[1]+dy;y<boardHeight-.99*padding;y+=dy)st+=" M"+(origin[0]+ticklength).toFixed(2)+","+y.toFixed(2)+" "+(origin[0]-ticklength).toFixed(2)+","+y.toFixed(2);for(y=boardHeight-origin[1]-dy;y>.99*padding;y-=dy)st+=" M"+(origin[0]+ticklength).toFixed(2)+","+y.toFixed(2)+" "+(origin[0]-ticklength).toFixed(2)+","+y.toFixed(2)}if(pnode.setAttribute("d",st),pnode.setAttribute("stroke-width",1),pnode.setAttribute("shape-rendering","crispEdges"),pnode.setAttribute("stroke",axesstroke),pnode.setAttribute("fill",fill),theSVG.appendChild(pnode),null!=labels&&"none"!=labels)with(Math){if(ldx=dx/xunitlength,ldy=dy/yunitlength,lx=xmin>0||xmax<0?xmin:0,ly=ymin>0||ymax<0?ymin:0,lxp=0==ly?"below":"above",lyp=0==lx?"left":"right",null!==gdx&&0!==gdx){var ddx=floor(1.1-log(ldx)/log(10))+2;for(x=ldx;x<=xmax;x+=ldx)text([x,ly],chopZ(x.toFixed(ddx)),lxp);for(x=-ldx;xmin<=x;x-=ldx)text([x,ly],chopZ(x.toFixed(ddx)),lxp);0==showYaxis&&text([0,ly],0,lxp)}if(null!==gdy&&0!==gdy){var ddy=Math.max(0,floor(1.1-log(ldy)/log(10))+2);if(ddy<0)return void console.log("ddy is < 0. Aborting...");if(1==showYaxis){for(y=ldy;y<=ymax;y+=ldy)text([lx,y],chopZ(y.toFixed(ddy)),lyp);for(y=-ldy;ymin<=y;y-=ldy)text([lx,y],chopZ(y.toFixed(ddy)),lyp)}}}void 0===xAxisVble&&(xAxisVble=window.xAxisVble),void 0===yAxisVble&&(yAxisVble=window.yAxisVble),txtLabelsClass="intmathItalic",text([xmax+(padding-10)/xunitlength,0],xAxisVble,"above",svgID+"xAxVbl","",'KaTeX_Math,"Times New Roman",Times,serif'),1==showYaxis&&text([0,ymax+(padding-10)/yunitlength],yAxisVble,"right",svgID+"yAxVbl","",'KaTeX_Math,"Times New Roman",Times,serif'),txtLabelsClass="intmath",markerstrokewidth=.5,stroke="#555",arrowhead([0,0],[xmax+padding/xunitlength,0],"xaxisArr"),1==showYaxis&&arrowhead([0,0],[0,ymax+padding/yunitlength],"yaxisArr")}}function initBoard(r,t,e,i,n){(boundingDiv=gebi(r)).style.position="relative",boardWidth=boundingDiv.getBoundingClientRect().width,boardHeight=Math.round(boardWidthToHeight*boardWidth),boardLeft=boundingDiv.getBoundingClientRect().left,boardTop=boundingDiv.getBoundingClientRect().top,makeSVG("svg",{id:svgID=r+"SVG",width:boardWidth,height:boardHeight},brdID=r),theSVG=gebi(svgID),currCartMatrix[brdID]=[],strokewidth="1",strokedasharray=null,stroke="black",fill="none",fontstyle="normal",fontfamily='KaTeX_Main,"Times New Roman",Times,serif',fontweight="normal",fontstroke="none",fontfill="none",marker="none",ymax=null,ymin=i,ymax=n,(xmin=t)>=(xmax=e)&&xmax++,ymin>=ymax&&null!=ymax&&ymax++,yunitlength=xunitlength=(boardWidth-2*padding)/(xmax-xmin),null==ymax?ymax=ymin+(boardHeight-2*padding)/yunitlength:yunitlength=(boardHeight-2*padding)/(ymax-ymin),origin=[-xmin*xunitlength+padding,-ymin*yunitlength+padding],boardPropsArr[brdID+"xMin"]=xmin,boardPropsArr[brdID+"yMin"]=ymin,boardPropsArr[brdID+"xMax"]=xmax,boardPropsArr[brdID+"yMax"]=ymax,boardPropsArr[brdID+"Width"]=boardWidth,boardPropsArr[brdID+"Height"]=boardHeight,boardPropsArr[brdID+"Left"]=boardLeft,boardPropsArr[brdID+"Top"]=boardTop,boardPropsArr[brdID+"XuL"]=xunitlength,boardPropsArr[brdID+"YuL"]=yunitlength,boardPropsArr[brdID+"ox"]=origin[0],boardPropsArr[brdID+"oy"]=origin[1],boardPropsArr[brdID+"pad"]=padding,brdPropsArr[brdID]=[],brdPropsArr[brdID].xMin=xmin,brdPropsArr[brdID].yMin=ymin,brdPropsArr[brdID].actualXmin=xmin-padding/xunitlength,brdPropsArr[brdID].actualYmin=ymin-padding/yunitlength,brdPropsArr[brdID].xMax=xmax,brdPropsArr[brdID].yMax=ymax,brdPropsArr[brdID].actualXmax=xmax+padding/xunitlength,brdPropsArr[brdID].actualYmax=ymax+padding/yunitlength,brdPropsArr[brdID].brdWidth=boardWidth,brdPropsArr[brdID].brdHeight=boardHeight,brdPropsArr[brdID].Left=boardLeft,brdPropsArr[brdID].Top=boardTop,brdPropsArr[brdID].XuL=xunitlength,brdPropsArr[brdID].YuL=yunitlength,brdPropsArr[brdID].ox=origin[0],brdPropsArr[brdID].oy=origin[1],brdPropsArr[brdID].pad=padding;makeSVG("rect",{id:"brdBg_"+brdID,x:0,y:0,width:boardWidth+"px",height:boardHeight+"px",stroke:"none",fill:"white"},svgID)}var doc=document,boundingDiv,brdID,svgID,boardPropsArr=[],brdPropsArr=[],viewPortWidth=window.innerWidth,clientWidth=document.body.clientWidth,viewPortHeight=window.innerHeight,clientHeight=document.body.clientHeight,clientWidthRem=clientWidth,viewPortWidthRem=viewPortWidth,clientHeightRem=clientHeight;viewPortHeightRem=viewPortHeight;var origin,cx,cy,dx,dy,labels,gdx,gdy,xAxisVble="x",yAxisVble="y",doAxes=1,showYaxis=1,doGrids=1,boardWidth,boardHeight,boardWidthToHeight=.75,boardLeft,boardTop,xMin,yMin,xMax,yMax,xunitlength,yunitlength,xmin,xmax,ymin,ymax,xgrid,ygrid,xtick,ytick,initialized,opacity,stroke,below,elementIdNum=999,padding=20,curveLength=0,txtLabelsClass="intmath",dragCnt=0,plotBeyondXVis=!1,plotBeyondYVis=!0,goToExtremities=!1,draggablePtsOnLine=!1,labelDraggablePts=!1,fontsize="14.4",gridstroke="#ddd",ticklength=4,axesstroke=corpColor,markerstrokewidth="1",strokedasharray=null,strokedashoffset=null,markerstroke=corpColor,markerfill=corpColor,markersize=4,marker="none",arrowfill="#555",dotradius=4,dotstrokewidth=1,segstrokewidth=1,strokeopacity=1,fillopacity=1,shaperendering=null,gliderOn="",dotDraggable=!1,cpi="π",ctheta="θ",pi=Math.PI,ln=Math.log,e=Math.E,arcsin=Math.asin,arccos=Math.acos,arctan=Math.atan,sin=function(r){return Math.sin(r)},cos=function(r){return Math.cos(r)},tan=function(r){return Math.tan(r)},sec=function(r){return 1/Math.cos(r)},csc=function(r){return 1/Math.sin(r)},cot=function(r){return 1/Math.tan(r)},logten=function(r){return Math.log(r)/Math.log(10)},arcsec=function(r){return arccos(1/r)},arccsc=function(r){return arcsin(1/r)},arccot=function(r){return arctan(1/r)},sinh=function(r){return(Math.exp(r)-Math.exp(-r))/2},cosh=function(r){return(Math.exp(r)+Math.exp(-r))/2},tanh=function(r){return(Math.exp(r)-Math.exp(-r))/(Math.exp(r)+Math.exp(-r))},sech=function(r){return 1/cosh(r)},csch=function(r){return 1/sinh(r)},coth=function(r){return 1/tanh(r)},arcsinh=function(r){return ln(r+Math.sqrt(r*r+1))},arccosh=function(r){return ln(r+Math.sqrt(r*r-1))},arctanh=function(r){return ln((1+r)/(1-r))/2},arcsech=function(r){return arccosh(1/r)},arccsch=function(r){return arcsinh(1/r)},arccoth=function(r){return arctanh(1/r)},sign=function(r){return 0==r?0:r<0?-1:1},transX,transY,transXRem,transYRem,xCart,yCart,xPix,yPix,cx,cy,eTarg,targetId,et,mseTchPosi,drag=null,dragging=!1,currCartMatrix=[],slicedSVG,resetCxCy=!1,isTouch=!1,etTxt=document.getElementById("etTxt"),tchX,tchY,tchPos;joinSegArr=[],joinLineArr=[];var x;window.addEventListener("resize",resizeThrottler,!1);var resizeTimeout;

