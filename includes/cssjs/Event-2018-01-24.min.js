/*
	Based on event.js : 1.1.5 : 2014/02/12 : MIT License, https://github.com/mudcube/Event.js
	Updated by IntMath.
*/

if(void 0===eventjs)var eventjs={};if(function(e){"use strict";e.modifyEventListener=!1,e.modifySelectors=!1,e.configure=function(t){isFinite(t.modifyEventListener)&&(e.modifyEventListener=t.modifyEventListener),isFinite(t.modifySelectors)&&(e.modifySelectors=t.modifySelectors),!1===l&&e.modifyEventListener&&p(),!1===g&&e.modifySelectors&&m()},e.add=function(e,t,r,o){return n(e,t,r,o,"add")},e.remove=function(e,t,r,o){return n(e,t,r,o,"remove")},e.returnFalse=function(e){return!1},e.stop=function(e){e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.cancelBubbleCount=0)},e.prevent=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},e.cancel=function(t){e.stop(t),e.prevent(t)},e.blur=function(){var e=document.activeElement;if(e){var t=document.activeElement.nodeName;"INPUT"!==t&&"TEXTAREA"!==t&&"true"!==e.contentEditable||e.blur&&e.blur()}},e.getEventSupport=function(e,t){if("string"==typeof e&&(t=e,e=window),(t="on"+t)in e)return!0;if(e.setAttribute||(e=document.createElement("div")),e.setAttribute&&e.removeAttribute){e.setAttribute(t,"");var n="function"==typeof e[t];return void 0!==e[t]&&(e[t]=null),e.removeAttribute(t),n}};var t=function(e){if(!e||"object"!=typeof e)return e;var n=new e.constructor;for(var r in e)e[r]&&"object"==typeof e[r]?n[r]=t(e[r]):n[r]=e[r];return n},n=function(i,s,v,l,p,g){if(l=l||{},"[object Object]"===String(i)){var m=i;if(i=m.target,delete m.target,!m.type||!m.listener){for(var y in m){var j=m[y];"function"!=typeof j&&(l[y]=j)}var h={};for(var w in m){var y=w.split(","),x=m[w],P={};for(var b in l)P[b]=l[b];if("function"==typeof x)v=x;else{if("function"!=typeof x.listener)continue;var v=x.listener;for(var b in x)"function"!=typeof x[b]&&(P[b]=x[b])}for(_=0;_<y.length;_++)h[w]=eventjs.add(i,y[_],v,P,p)}return h}s=m.type,delete m.type,v=m.listener,delete m.listener;for(var w in m)l[w]=m[w]}if(i&&s&&v){if("string"==typeof i&&"ready"===s){if(!window.eventjs_stallOnReady){var M=(new Date).getTime(),E=l.timeout,D=l.interval||1e3/60,T=window.setInterval(function(){(new Date).getTime()-M>E&&window.clearInterval(T),document.querySelector(i)&&(window.clearInterval(T),setTimeout(v,1))},D);return}s="load",i=window}if("string"==typeof i){if(0===(i=document.querySelectorAll(i)).length)return o("Missing target on listener!",arguments);1===i.length&&(i=i[0])}var G,L={};if(i.length>0&&i!==window){for(var k=0,X=i.length;k<X;k++)(G=n(i[k],s,v,t(l),p))&&(L[k]=G);return r(L)}if("string"==typeof s&&(-1!==(s=s.toLowerCase()).indexOf(" ")?s=s.split(" "):-1!==s.indexOf(",")&&(s=s.split(","))),"string"!=typeof s){if("number"==typeof s.length)for(var S=0,Y=s.length;S<Y;S++)(G=n(i,s[S],v,t(l),p))&&(L[s[S]]=G);else for(var w in s)(G="function"==typeof s[w]?n(i,w,s[w],t(l),p):n(i,w,s[w].listener,t(s[w]),p))&&(L[w]=G);return r(L)}if(0===s.indexOf("on")&&(s=s.substr(2)),"object"!=typeof i)return o("Target is not defined!",arguments);if("function"!=typeof v)return o("Listener is not a function!",arguments);var H=l.useCapture||!1,U=d(i)+"."+d(v)+"."+(H?1:0);if(e.Gesture&&e.Gesture._gestureHandlers[s]){if(U=s+U,"remove"===p){if(!u[U])return;u[U].remove(),delete u[U]}else if("add"===p){if(u[U])return u[U].add(),u[U];if(l.useCall&&!e.modifyEventListener){var C=v;v=function(e,t){for(var n in t)e[n]=t[n];return C.call(i,e)}}l.gesture=s,l.target=i,l.listener=v,l.fromOverwrite=g,u[U]=e.proxy[s](l)}return u[U]}for(var F,O=a(s),_=0;_<O.length;_++)if(s=O[_],F=s+"."+U,"remove"===p){if(!u[F])continue;i[f](s,v,H),delete u[F]}else if("add"===p){if(u[F])return u[F];i[c](s,v,H),u[F]={id:F,type:s,target:i,listener:v,remove:function(){for(var t=0;t<O.length;t++)e.remove(i,O[t],v,l)}}}return u[F]}},r=function(e){return{remove:function(){for(var t in e)e[t].remove()},add:function(){for(var t in e)e[t].add()}}},o=function(e,t){"undefined"!=typeof console&&void 0!==console.error&&console.error(e,t)},i={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},s={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2},a=(e.supports={},window.navigator.msPointerEnabled&&(e.supports.msPointer=!0),e.getEventSupport("touchstart")&&(e.supports.touch=!0),e.getEventSupport("mousedown")&&(e.supports.mouse=!0),function(t){var n=document.addEventListener?"":"on",r=s[t];if(isFinite(r)){var o=[];for(var a in e.supports)o.push(n+i[a][r]);return o}return[n+t]}),u={},v=0,d=function(e){return e===window?"#window":e===document?"#document":(e.uniqueID||(e.uniqueID="e"+v++),e.uniqueID)},c=document.addEventListener?"addEventListener":"attachEvent",f=document.removeEventListener?"removeEventListener":"detachEvent";e.createPointerEvent=function(t,n,r){var o=n.gesture,i=n.target,s=t.changedTouches||e.proxy.getCoords(t);if(s.length){var a=s[0];n.pointers=r?[]:s,n.pageX=a.pageX,n.pageY=a.pageY,n.x=n.pageX,n.y=n.pageY}var u=document.createEvent("Event");u.initEvent(o,!0,!0),u.originalEvent=t;for(var v in n)"target"!==v&&(u[v]=n[v]);var d=u.type;e.Gesture&&e.Gesture._gestureHandlers[d]&&n.oldListener.call(i,u,n,!1)};var l=!1,p=function(){if(window.HTMLElement){var t=function(t){var r=function(r){var o=r+"EventListener",i=t[o];t[o]=function(t,o,s){if(e.Gesture&&e.Gesture._gestureHandlers[t]){var u=s;"object"==typeof s?u.useCall=!0:u={useCall:!0,useCapture:s},n(this,t,o,u,r,!0)}else for(var v=a(t),d=0;d<v.length;d++)i.call(this,v[d],o,s)}};r("add"),r("remove")};navigator.userAgent.match(/Firefox/)?(t(HTMLDivElement.prototype),t(HTMLCanvasElement.prototype)):t(HTMLElement.prototype),t(document),t(window)}},g=!1,m=function(){var e=NodeList.prototype;e.removeEventListener=function(e,t,n){for(var r=0,o=this.length;r<o;r++)this[r].removeEventListener(e,t,n)},e.addEventListener=function(e,t,n){for(var r=0,o=this.length;r<o;r++)this[r].addEventListener(e,t,n)}}}(eventjs),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";e.pointerSetup=function(e,t){e.target=e.target||window,e.doc=e.target.ownerDocument||e.target,e.minFingers=e.minFingers||e.fingers||1,e.maxFingers=e.maxFingers||e.fingers||1/0,e.position=e.position||"relative",delete e.fingers,(t=t||{}).enabled=!0,t.gesture=e.gesture,t.target=e.target,t.env=e.env,eventjs.modifyEventListener&&e.fromOverwrite&&(e.oldListener=e.listener,e.listener=eventjs.createPointerEvent);var n=0,r=0===t.gesture.indexOf("pointer")&&eventjs.modifyEventListener?"pointer":"mouse";return e.oldListener&&(t.oldListener=e.oldListener),t.listener=e.listener,t.proxy=function(n){t.defaultListener=e.listener,e.listener=n,n(e.event,t)},t.add=function(){!0!==t.enabled&&(e.onPointerDown&&eventjs.add(e.target,r+"down",e.onPointerDown),e.onPointerMove&&eventjs.add(e.doc,r+"move",e.onPointerMove),e.onPointerUp&&eventjs.add(e.doc,r+"up",e.onPointerUp),t.enabled=!0)},t.remove=function(){!1!==t.enabled&&(e.onPointerDown&&eventjs.remove(e.target,r+"down",e.onPointerDown),e.onPointerMove&&eventjs.remove(e.doc,r+"move",e.onPointerMove),e.onPointerUp&&eventjs.remove(e.doc,r+"up",e.onPointerUp),t.reset(),t.enabled=!1)},t.pause=function(t){!e.onPointerMove||t&&!t.move||eventjs.remove(e.doc,r+"move",e.onPointerMove),!e.onPointerUp||t&&!t.up||eventjs.remove(e.doc,r+"up",e.onPointerUp),n=e.fingers,e.fingers=0},t.resume=function(t){!e.onPointerMove||t&&!t.move||eventjs.add(e.doc,r+"move",e.onPointerMove),!e.onPointerUp||t&&!t.up||eventjs.add(e.doc,r+"up",e.onPointerUp),e.fingers=n},t.reset=function(){e.tracker={},e.fingers=0},t};var t=eventjs.supports;eventjs.isMouse=!!t.mouse,eventjs.isMSPointer=!!t.touch,eventjs.isTouch=!!t.msPointer,e.pointerStart=function(t,n,r){var o=(t.type||"mousedown").toUpperCase();0===o.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===o.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===o.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);var i=function(e,t){var n=r.bbox,o=a[t]={};switch(r.position){case"absolute":o.offsetX=0,o.offsetY=0;break;case"differenceFromLast":case"difference":o.offsetX=e.pageX,o.offsetY=e.pageY;break;case"move":o.offsetX=e.pageX-n.x1,o.offsetY=e.pageY-n.y1;break;default:o.offsetX=n.x1-n.scrollLeft,o.offsetY=n.y1-n.scrollTop}var i=e.pageX-o.offsetX,s=e.pageY-o.offsetY;o.rotation=0,o.scale=1,o.startTime=o.moveTime=(new Date).getTime(),o.move={x:i,y:s},o.start={x:i,y:s},r.fingers++};r.event=t,n.defaultListener&&(r.listener=n.defaultListener,delete n.defaultListener);for(var s=!r.fingers,a=r.tracker,u=t.changedTouches||e.getCoords(t),v=u.length,d=0;d<v;d++){var c=u[d],f=c.identifier||1/0;if(r.fingers){if(r.fingers>=r.maxFingers){g=[];for(var f in r.tracker)g.push(f);return n.identifier=g.join(","),s}var l=0;for(var p in a){if(a[p].up){delete a[p],i(c,f),r.cancel=!0;break}l++}if(a[f])continue;i(c,f)}else a=r.tracker={},n.bbox=r.bbox=e.getBoundingBox(r.target),r.fingers=0,r.cancel=!1,i(c,f)}var g=[];for(var f in r.tracker)g.push(f);return n.identifier=g.join(","),s},e.pointerEnd=function(e,t,n,r){for(var o=e.touches||[],i=o.length,s={},a=0;a<i;a++)s[(u=o[a].identifier)||1/0]=!0;for(var u in n.tracker){var v=n.tracker[u];s[u]||v.up||(r&&r({pageX:v.pageX,pageY:v.pageY,changedTouches:[{pageX:v.pageX,pageY:v.pageY,identifier:"Infinity"===u?1/0:u}]},"up"),v.up=!0,n.fingers--)}if(0!==n.fingers)return!1;var d=[];n.gestureFingers=0;for(var u in n.tracker)n.gestureFingers++,d.push(u);return t.identifier=d.join(","),!0},e.getCoords=function(t){return void 0!==t.pageX?e.getCoords=function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||1/0})}:e.getCoords=function(e){var t=document.documentElement;return e=e||window.event,Array({type:"mouse",x:e.clientX+t.scrollLeft,y:e.clientY+t.scrollTop,pageX:e.clientX+t.scrollLeft,pageY:e.clientY+t.scrollTop,identifier:1/0})},e.getCoords(t)},e.getCoord=function(t){if("ontouchstart"in window){var n=0,r=0;e.getCoord=function(e){var t=e.changedTouches;return t&&t.length?{x:n=t[0].pageX,y:r=t[0].pageY}:{x:n,y:r}}}else void 0!==t.pageX&&void 0!==t.pageY?e.getCoord=function(e){return{x:e.pageX,y:e.pageY}}:e.getCoord=function(e){var t=document.documentElement;return e=e||window.event,{x:e.clientX+t.scrollLeft,y:e.clientY+t.scrollTop}};return e.getCoord(t)};var n=function(e,t){var n=parseFloat(e.getPropertyValue(t),10);return isFinite(n)?n:0};return e.getBoundingBox=function(e){e!==window&&e!==document||(e=document.body);var t={},r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.x1=r.left,t.y1=r.top,t.scaleX=r.width/e.offsetWidth||1,t.scaleY=r.height/e.offsetHeight||1,t.scrollLeft=0,t.scrollTop=0;var o=window.getComputedStyle(e);if(!1===("border-box"===o.getPropertyValue("box-sizing"))){var i=n(o,"border-left-width"),s=n(o,"border-right-width"),a=n(o,"border-bottom-width"),u=n(o,"border-top-width");t.border=[i,s,u,a],t.x1+=i,t.y1+=u,t.width-=s+i,t.height-=a+u}t.x2=t.x1+t.width,t.y2=t.y1+t.height;for(var v=o.getPropertyValue("position"),d="fixed"===v?e:e.parentNode;null!==d&&d!==document.body&&void 0!==d.scrollTop;){if("absolute"===(v=(o=window.getComputedStyle(d)).getPropertyValue("position")));else{if("fixed"===v){t.scrollTop-=d.parentNode.scrollTop,t.scrollLeft-=d.parentNode.scrollLeft;break}t.scrollLeft+=d.scrollLeft,t.scrollTop+=d.scrollTop}d=d.parentNode}return t.scrollBodyLeft=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t.scrollBodyTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,t.scrollLeft-=t.scrollBodyLeft,t.scrollTop-=t.scrollBodyTop,t},function(){var t,n=navigator.userAgent.toLowerCase(),r=-1!==n.indexOf("macintosh");t=r&&-1!==n.indexOf("khtml")?{91:!0,93:!0}:r&&-1!==n.indexOf("firefox")?{224:!0}:{17:!0},(e.metaTrackerReset=function(){eventjs.fnKey=e.fnKey=!1,eventjs.metaKey=e.metaKey=!1,eventjs.escKey=e.escKey=!1,eventjs.ctrlKey=e.ctrlKey=!1,eventjs.shiftKey=e.shiftKey=!1,eventjs.altKey=e.altKey=!1})(),e.metaTracker=function(n){var r="keydown"===n.type;27===n.keyCode&&(eventjs.escKey=e.escKey=r),t[n.keyCode]&&(eventjs.metaKey=e.metaKey=r),eventjs.ctrlKey=e.ctrlKey=n.ctrlKey,eventjs.shiftKey=e.shiftKey=n.shiftKey,eventjs.altKey=e.altKey=n.altKey}}(),e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(eventjs.MutationObserver=function(){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,t=!e&&function(){var e=document.createElement("p"),t=!1,n=function(){t=!0};if(e.addEventListener)e.addEventListener("DOMAttrModified",n,!1);else{if(!e.attachEvent)return!1;e.attachEvent("onDOMAttrModified",n)}return e.setAttribute("id","target"),t}();return function(n,r){if(e){var o={subtree:!1,attributes:!0};new e(function(e){e.forEach(function(e){r.call(e.target,e.attributeName)})}).observe(n,o)}else t?eventjs.add(n,"DOMAttrModified",function(e){r.call(n,e.attrName)}):"onpropertychange"in document.body&&eventjs.add(n,"propertychange",function(e){r.call(n,window.event.propertyName)})}}(),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.click=function(t){t.gesture=t.gesture||"click",t.maxFingers=t.maxFingers||t.fingers||1,t.onPointerDown=function(r){e.pointerStart(r,n,t)&&eventjs.add(t.target,"mouseup",t.onPointerUp)},t.onPointerUp=function(r){if(e.pointerEnd(r,n,t)){eventjs.remove(t.target,"mouseup",t.onPointerUp);var o=(r.changedTouches||e.getCoords(r))[0],i=t.bbox,s=e.getBoundingBox(t.target),a=o.pageY-s.scrollBodyTop,u=o.pageX-s.scrollBodyLeft;if(u>i.x1&&a>i.y1&&u<i.x2&&a<i.y2&&i.scrollTop===s.scrollTop){for(var v in t.tracker)break;var d=t.tracker[v];n.x=d.start.x,n.y=d.start.y,t.listener(r,n)}}};var n=e.pointerSetup(t);return n.state="click",eventjs.add(t.target,"mousedown",t.onPointerDown),n},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.click=e.click,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.dbltap=e.dblclick=function(t){t.gesture=t.gesture||"dbltap",t.maxFingers=t.maxFingers||t.fingers||1;var n,r,o,i,s;t.onPointerDown=function(u){var v=u.changedTouches||e.getCoords(u);n&&!r?(s=v[0],r=(new Date).getTime()-n):(i=v[0],n=(new Date).getTime(),r=0,clearTimeout(o),o=setTimeout(function(){n=0},700)),e.pointerStart(u,a,t)&&(eventjs.add(t.target,"mousemove",t.onPointerMove).listener(u),eventjs.add(t.target,"mouseup",t.onPointerUp))},t.onPointerMove=function(a){if(n&&!r){var u=a.changedTouches||e.getCoords(a);s=u[0]}var v=t.bbox,d=s.pageX-v.x1,c=s.pageY-v.y1;d>0&&d<v.width&&c>0&&c<v.height&&Math.abs(s.pageX-i.pageX)<=25&&Math.abs(s.pageY-i.pageY)<=25||(eventjs.remove(t.target,"mousemove",t.onPointerMove),clearTimeout(o),n=r=0)},t.onPointerUp=function(i){if(e.pointerEnd(i,a,t)&&(eventjs.remove(t.target,"mousemove",t.onPointerMove),eventjs.remove(t.target,"mouseup",t.onPointerUp)),n&&r){if(r<=700){a.state=t.gesture;for(var s in t.tracker)break;var u=t.tracker[s];a.x=u.start.x,a.y=u.start.y,t.listener(i,a)}clearTimeout(o),n=r=0}};var a=e.pointerSetup(t);return a.state="dblclick",eventjs.add(t.target,"mousedown",t.onPointerDown),a},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.dbltap=e.dbltap,eventjs.Gesture._gestureHandlers.dblclick=e.dblclick,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.dragElement=function(t,n){e.drag({event:n,target:t,position:"move",listener:function(e,n){t.style.left=n.x+"px",t.style.top=n.y+"px",eventjs.prevent(e)}})},e.drag=function(t){t.gesture="drag",t.onPointerDown=function(r){"function"==typeof doOnPointerDown&&(targID.length>0&&(brdID=gebi(targID).parentNode.parentNode.id),void 0!==brdPropsArr[brdID][targID]&&void 0!==brdPropsArr[brdID][targID].transRem&&(brdPropsArr[brdID][targID].trans=brdPropsArr[brdID][targID].transRem),doOnPointerDown(r)),"touchstart"==r.type&&r.preventDefault(),e.pointerStart(r,n,t)&&(t.monitor||(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),n.id=r.target.id,t.onPointerMove(r,"down")},t.onPointerMove=function(r,o){if("function"==typeof doOnPointerMove&&doOnPointerMove(r),!t.tracker)return t.onPointerDown(r);for(var i=t.bbox,s=r.changedTouches||e.getCoords(r),a=s.length,u=0;u<a;u++){var v=s[u],d=v.identifier||1/0,c=t.tracker[d];if(c){if(c.pageX=v.pageX,c.pageY=v.pageY,n.state=o||"move",n.identifier=d,n.start=c.start,n.fingers=t.fingers,"differenceFromLast"===t.position)n.x=c.pageX-c.offsetX,n.y=c.pageY-c.offsetY,c.offsetX=c.pageX,c.offsetY=c.pageY,console.log("1272->"+n.x);else{var f=n.target.r.baseVal.value;if(i.width>2*f)l=i.width/2-f;else var l=0;n.x=c.pageX-c.offsetX-l,n.y=c.pageY-c.offsetY-l}t.listener(r,n)}}},t.onPointerUp=function(r){"function"==typeof doOnPointerUp&&doOnPointerUp(r),e.pointerEnd(r,n,t,t.onPointerMove)&&(t.monitor||(eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp)))};var n=e.pointerSetup(t);return t.event?t.onPointerDown(t.event):(eventjs.add(t.target,"mousedown",t.onPointerDown),t.monitor&&(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),n},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.drag=e.drag,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";var t=Math.PI/180,n=function(e,t){var n=0,r=0,o=0;for(var i in t){var s=t[i];s.up||(n+=s.move.x,r+=s.move.y,o++)}return e.x=n/=o,e.y=r/=o,e};return e.gesture=function(r){r.gesture=r.gesture||"gesture",r.minFingers=r.minFingers||r.fingers||2,r.onPointerDown=function(t){var i=r.fingers;if(e.pointerStart(t,o,r)&&(eventjs.add(r.doc,"mousemove",r.onPointerMove),eventjs.add(r.doc,"mouseup",r.onPointerUp)),r.fingers===r.minFingers&&i!==r.fingers){o.fingers=r.minFingers,o.scale=1,o.rotation=0,o.state="start";var s="";for(var a in r.tracker)s+=a;o.identifier=parseInt(s),n(o,r.tracker),r.listener(t,o)}},r.onPointerMove=function(i,s){for(var a=r.bbox,u=r.tracker,v=(f=i.changedTouches||e.getCoords(i)).length,d=0;d<v;d++){var c=u[g=(m=f[d]).identifier||1/0];c&&(c.move.x=m.pageX-a.x1,c.move.y=m.pageY-a.y1)}if(!(r.fingers<r.minFingers)){var f=[],l=0,p=0;n(o,u);for(var g in u){var m=u[g];if(!m.up){var y=m.start;if(!y.distance){var j=y.x-o.x,h=y.y-o.y;y.distance=Math.sqrt(j*j+h*h),y.angle=Math.atan2(j,h)/t}var j=m.move.x-o.x,h=m.move.y-o.y;l+=Math.sqrt(j*j+h*h)/y.distance;var w=Math.atan2(j,h)/t,x=(y.angle-w+360)%360-180;m.DEG2=m.DEG1,m.DEG1=x>0?x:-x,void 0!==m.DEG2&&(x>0?m.rotation+=m.DEG1-m.DEG2:m.rotation-=m.DEG1-m.DEG2,p+=m.rotation),f.push(m.move)}}o.touches=f,o.fingers=r.fingers,o.scale=l/r.fingers,o.rotation=p/r.fingers,o.state="change",r.listener(i,o)}},r.onPointerUp=function(t){var n=r.fingers;e.pointerEnd(t,o,r)&&(eventjs.remove(r.doc,"mousemove",r.onPointerMove),eventjs.remove(r.doc,"mouseup",r.onPointerUp)),n===r.minFingers&&r.fingers<r.minFingers&&(o.fingers=r.fingers,o.state="end",r.listener(t,o))};var o=e.pointerSetup(r);return eventjs.add(r.target,"mousedown",r.onPointerDown),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.gesture=e.gesture,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.pointerdown=e.pointermove=e.pointerup=function(t){if(t.gesture=t.gesture||"pointer",!t.target.isPointerEmitter){var n=!0;t.onPointerDown=function(e){n=!1,r.gesture="pointerdown",t.listener(e,r)},t.onPointerMove=function(e){r.gesture="pointermove",t.listener(e,r,n)},t.onPointerUp=function(e){n=!0,r.gesture="pointerup",t.listener(e,r,!0)};var r=e.pointerSetup(t);return eventjs.add(t.target,"mousedown",t.onPointerDown),eventjs.add(t.target,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp),t.target.isPointerEmitter=!0,r}},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.pointerdown=e.pointerdown,eventjs.Gesture._gestureHandlers.pointermove=e.pointermove,eventjs.Gesture._gestureHandlers.pointerup=e.pointerup,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.shake=function(e){var t={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:e.target,listener:e.listener,remove:function(){window.removeEventListener("devicemotion",i,!1)}},n=(new Date).getTime(),r={x:0,y:0,z:0},o={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},i=function(i){var s=i.accelerationIncludingGravity;if(r.x=.8*r.x+(1-.8)*s.x,r.y=.8*r.y+(1-.8)*s.y,r.z=.8*r.z+(1-.8)*s.z,t.accelerationIncludingGravity=r,t.acceleration.x=s.x-r.x,t.acceleration.y=s.y-r.y,t.acceleration.z=s.z-r.z,"devicemotion"!==e.gesture)for(var a=(new Date).getTime(),u=0,v="xyz".length;u<v;u++){var d="xyz"[u],c=t.acceleration[d],f=o[d],l=Math.abs(c);if(!(a-n<1e3)&&l>4){var p=a*c/l,g=Math.abs(p+f.value);f.value&&g<200?(f.value=p,3===++f.count&&(e.listener(i,t),n=a,f.value=0,f.count=0)):(f.value=p,f.count=1)}}else e.listener(i,t)};if(window.addEventListener)return window.addEventListener("devicemotion",i,!1),t},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.shake=e.shake,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";var t=Math.PI/180;return e.swipe=function(n){n.snap=n.snap||90,n.threshold=n.threshold||1,n.gesture=n.gesture||"swipe",n.onPointerDown=function(t){e.pointerStart(t,r,n)&&(eventjs.add(n.doc,"mousemove",n.onPointerMove).listener(t),eventjs.add(n.doc,"mouseup",n.onPointerUp))},n.onPointerMove=function(t){for(var r=t.changedTouches||e.getCoords(t),o=r.length,i=0;i<o;i++){var s=r[i],a=s.identifier||1/0,u=n.tracker[a];u&&(u.move.x=s.pageX,u.move.y=s.pageY,u.moveTime=(new Date).getTime())}},n.onPointerUp=function(o){if(e.pointerEnd(o,r,n)){eventjs.remove(n.doc,"mousemove",n.onPointerMove),eventjs.remove(n.doc,"mouseup",n.onPointerUp);var i,s,a={x:0,y:0},u=0,v=0,d=0;for(var c in n.tracker){var f=n.tracker[c],l=f.move.x-f.start.x,p=f.move.y-f.start.y;u+=f.move.x,v+=f.move.y,a.x+=f.start.x,a.y+=f.start.y,d++;var g=Math.sqrt(l*l+p*p),m=f.moveTime-f.startTime,y=Math.atan2(l,p)/t+180,j=m?g/m:0;if(void 0===s)s=y,i=j;else{if(!(Math.abs(y-s)<=20))return;s=(s+y)/2,i=(i+j)/2}}var h=n.gestureFingers;n.minFingers<=h&&n.maxFingers>=h&&i>n.threshold&&(a.x/=d,a.y/=d,r.start=a,r.x=u/d,r.y=v/d,r.angle=-(((s/n.snap+.5>>0)*n.snap||360)-360),r.velocity=i,r.fingers=h,r.state="swipe",n.listener(o,r))}};var r=e.pointerSetup(n);return eventjs.add(n.target,"mousedown",n.onPointerDown),r},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.swipe=e.swipe,e}(eventjs.proxy),void 0===eventjs)var eventjs={};if(void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.longpress=function(t){return t.gesture="longpress",e.tap(t)},e.tap=function(t){t.delay=t.delay||500,t.timeout=t.timeout||250,t.driftDeviance=t.driftDeviance||10,t.gesture=t.gesture||"tap";var n,r;t.onPointerDown=function(i){if(e.pointerStart(i,o,t)){if(n=(new Date).getTime(),eventjs.add(t.doc,"mousemove",t.onPointerMove).listener(i),eventjs.add(t.doc,"mouseup",t.onPointerUp),"longpress"!==t.gesture)return;r=setTimeout(function(){if(!(i.cancelBubble&&++i.cancelBubbleCount>1)){var e=0;for(var n in t.tracker){var r=t.tracker[n];if(!0===r.end)return;if(t.cancel)return;e++}t.minFingers<=e&&t.maxFingers>=e&&(o.state="start",o.fingers=e,o.x=r.start.x,o.y=r.start.y,t.listener(i,o))}},t.delay)}},t.onPointerMove=function(n){for(var r=t.bbox,o=n.changedTouches||e.getCoords(n),i=o.length,s=0;s<i;s++){var a=o[s],u=a.identifier||1/0,v=t.tracker[u];if(v){var d=a.pageX-r.x1,c=a.pageY-r.y1,f=d-v.start.x,l=c-v.start.y,p=Math.sqrt(f*f+l*l);if(!(d>0&&d<r.width&&c>0&&c<r.height&&p<=t.driftDeviance))return eventjs.remove(t.doc,"mousemove",t.onPointerMove),void(t.cancel=!0)}}},t.onPointerUp=function(i){if(e.pointerEnd(i,o,t)){if(clearTimeout(r),eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp),i.cancelBubble&&++i.cancelBubbleCount>1)return;if("longpress"===t.gesture)return void("start"===o.state&&(o.state="end",t.listener(i,o)));if(t.cancel)return;if((new Date).getTime()-n>t.timeout)return;var s=t.gestureFingers;t.minFingers<=s&&t.maxFingers>=s&&(o.state="tap",o.fingers=t.gestureFingers,t.listener(i,o))}};var o=e.pointerSetup(t);return eventjs.add(t.target,"mousedown",t.onPointerDown),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.tap=e.tap,eventjs.Gesture._gestureHandlers.longpress=e.longpress,e}(eventjs.proxy),void 0===eventjs)var eventjs={};void 0===eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.wheelPreventElasticBounce=function(e){e&&("string"==typeof e&&(e=document.querySelector(e)),eventjs.add(e,"wheel",function(e,t){t.preventElasticBounce(),eventjs.stop(e)}))},e.wheel=function(e){var t,n=e.timeout||150,r=0,o={gesture:"wheel",state:"start",wheelDelta:0,target:e.target,listener:e.listener,preventElasticBounce:function(e){var t=this.target,n=t.scrollTop;n+t.offsetHeight===t.scrollHeight&&this.wheelDelta<=0?eventjs.cancel(e):0===n&&this.wheelDelta>=0&&eventjs.cancel(e),eventjs.stop(e)},add:function(){e.target[s](u,i,!1)},remove:function(){e.target[a](u,i,!1)}},i=function(i){i=i||window.event,o.state=r++?"change":"start",o.wheelDelta=i.detail?-20*i.detail:i.wheelDelta,e.listener(i,o),clearTimeout(t),t=setTimeout(function(){r=0,o.state="end",o.wheelDelta=0,e.listener(i,o)},n)},s=document.addEventListener?"addEventListener":"attachEvent",a=document.removeEventListener?"removeEventListener":"detachEvent",u=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";return e.target[s](u,i,!1),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.wheel=e.wheel,e}(eventjs.proxy);